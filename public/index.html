<!DOCTYPE html>

<head>
    <!-- chessjs requires jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js" integrity="sha512-xRllwz2gdZciIB+AkEbeq+gVhX8VB8XsfqeFbUh+SzHlN96dEduwtTuVuc2u9EROlmW9+yhRlxjif66ORpsgVA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- chessboardjs -->
    <link rel="stylesheet" href="chessboardjs/css/chessboard-1.0.0.min.css">
    <script src="chessboardjs/js/chessboard-1.0.0.min.js"></script>

    <link rel="stylesheet" href="style.css">
</head>

<style type="text/css">
    .highlight-white {
      box-shadow: inset 0 0 3px 3px yellow;
    }
    .highlight-black {
      box-shadow: inset 0 0 3px 3px blue;
    }
</style>

<body>
  <h1 id="title">JS Project - Chess Board Game</h1>
  <p id="groupname">by William Dann and Claudia Souza</p>

  <br>
  <h3>Join a Game</h3>
  <form id="info_form" name = "getName">
    <label for = "user_name"> Player name: </label>
    <input type = "text" name = "PlayerName" id = "user_name"><br>
    <label for = "join_code"> Join Code: </label>
    <input type = "text" name = "JoinCode" id = "join_code">
    <input type = "submit" value = "Send">
    </form>
    <br>

    <h3>Create a Game</h3>
    <button onclick="handleNewGame()">New Game</button>
    <br>

    <script>
        // handle form submission
        document.querySelector("form").addEventListener('submit', event => {
          event.preventDefault(); // prevent page from doing usual redirects and stuff

          player_name = event.target.querySelector('#user_name').value;
          gameID      = event.target.querySelector('#join_code').value;

          if (player_name == "") 
            return alert ("Please enter a name.");
          if (gameID == "")
            return alert ("Please enter the code of a game you wish to join.");

          console.log("Loaded:")
          console.log(player_name)
          console.log(gameID)
          console.log('---')
        });


        async function createNewGame() {
          const response = await fetch('/game', {
            method: 'POST',
            cors: 'cors',
            cache: 'no-cache',
            credentials: 'same-origin',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded'
            },
            redirect: 'follow',
            referrerPolicy: 'no-referrer',
          });

          const data = await response.json();
          return data.id;
        }

        async function handleNewGame() {
          // send request to create new game
          const newid = await createNewGame();

          gameID = newid;
          console.log("Game created: " + newid);
          updateStatus()
        }

    </script>

    <gameArea id="boardChess"> 
    <div id="myBoard" style="width: 400px"></div>
    <label>Status:</label>
    <div id="status"></div>
    <label>FEN:</label>
    <div id="fen"></div>
    <label>PGN:</label>
    <div id="pgn"></div>
    <label>GameID: </label>
    <div id="game_id"></div>
    
    <script src="chess.js"></script>
    </gameArea>
    
</body>